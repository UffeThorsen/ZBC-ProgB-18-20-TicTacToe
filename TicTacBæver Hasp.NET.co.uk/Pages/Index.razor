@inject IJSRuntime JSRuntime
@page "/"
@using Microsoft.AspNetCore.Components.Web

<div>
    <div style="position: absolute; right:60.5%; top:15%">
        <select @bind="BeaverUI.a">
            @foreach (string key in BeaverUI.PlayerA.Keys.ToArray())
            {
                <option value="@key">@key</option>
            }
        </select>
        <img class="mx-auto" src="@BeaverUI.SymbolToImage(Symbol.X,coolMode)" style="position: absolute; top: 120%; left: 13%;"/>
    </div>
    <div style="position: absolute; left:60.5%; top:15%">
        <select @bind="BeaverUI.b">
            @foreach (string key in BeaverUI.PlayerB.Keys.ToArray())
            {
                <option value="@key">@key</option>
            }
        </select>
        <img class="mx-auto" src="@BeaverUI.SymbolToImage(Symbol.O,coolMode)" style="position: absolute; top: 120%; right: 13%;"/>
    </div>
    <button class="btn btn-primary" style="left:35%; top:-10%; margin-left:47.2%; margin-bottom:0.5%" @onclick="(() => StartNewGame())"> New Game </button>
    @if (BeaverUI.game != null)
    {
        <div class="row">
            <img src="@BeaverUI.SymbolToImage(BeaverUI.game[0, 0], @coolMode)" class="collo unselectable ml-auto" @onclick="(() => ClickOnButton(0, 0))" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@BeaverUI.SymbolToImage(BeaverUI.game[1, 0], @coolMode)" class="collo unselectable" @onclick="(() => ClickOnButton(1, 0))" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@BeaverUI.SymbolToImage(BeaverUI.game[2, 0], @coolMode)" class="collo unselectable mr-auto" @onclick="(() => ClickOnButton(2, 0))" draggable="false" unselectable="on" ondragstart="return false" />
        </div>
        <div class="row">
            <img src="@BeaverUI.SymbolToImage(BeaverUI.game[0, 1], @coolMode)" class="collo unselectable ml-auto" @onclick="(() => ClickOnButton(0, 1))" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@BeaverUI.SymbolToImage(BeaverUI.game[1, 1], @coolMode)" class="collo unselectable" @onclick="(() => ClickOnButton(1, 1))" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@BeaverUI.SymbolToImage(BeaverUI.game[2, 1], @coolMode)" class="collo unselectable mr-auto" @onclick="(() => ClickOnButton(2, 1))" draggable="false" unselectable="on" ondragstart="return false" />
        </div>
        <div class="row">
            <img src="@BeaverUI.SymbolToImage(BeaverUI.game[0, 2], @coolMode)" class="collo unselectable ml-auto" @onclick="(() => ClickOnButton(0, 2))" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@BeaverUI.SymbolToImage(BeaverUI.game[1, 2], @coolMode)" class="collo unselectable" @onclick="(() => ClickOnButton(1, 2))" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@BeaverUI.SymbolToImage(BeaverUI.game[2, 2], @coolMode)" class="collo unselectable mr-auto" @onclick="(() => ClickOnButton(2, 2))" draggable="false" unselectable="on" ondragstart="return false" />
        </div>
        <div class="row">
            <div class="mx-auto">
                @BeaverUI.status
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <img src="@Default" value="a" @onclick="(()=>Konami('A'))" class="collo unselectable ml-auto" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@Default" value="up"@onclick="(()=>Konami('U'))" class="collo unselectable" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@Default" @onclick="(()=>Konami(' '))" class="collo unselectable mr-auto" draggable="false" unselectable="on" ondragstart="return false" />
        </div>
        <div class="row">
            <img src="@Default" value="left" @onclick="(()=>Konami('L'))" class="collo unselectable ml-auto" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@Default" @onclick="(()=>Konami(' '))" class="collo unselectable" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@Default" value="right" @onclick="(()=>Konami('R'))" class="collo unselectable mr-auto" draggable="false" unselectable="on" ondragstart="return false" />
        </div>
        <div class="row">
            <img src="@Default" @onclick="(()=>Konami(' '))" class="collo unselectable ml-auto" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@Default" value="down" @onclick="(()=>Konami('D'))" class="collo unselectable" draggable="false" unselectable="on" ondragstart="return false" />
            <img src="@Default" value="b" @onclick="(()=>Konami('B'))" class="collo unselectable mr-auto" draggable="false" unselectable="on" ondragstart="return false" />
        </div>
        <div class="row">
            <div class="mx-auto">
                Welcome!
            </div>
        </div>
    }
</div>



@code
{
    string konami;

    bool coolMode = false;

    string Default
    {
        get
        {
            if (coolMode)
                return "/aa.png";
            return "/Blank.png";
        }
    }

    void Konami(char c)
    {
        konami += c;
        if (konami == "UUDDLRLRBA")
        {
            coolMode = true;
            StateHasChanged();
        }
    }

    void StartNewGame()
    {
        if (BeaverUI.pageUpdate == null)
        {
            BeaverUI.pageUpdate = new Action(UpdateScreen);
        }
        BeaverUI.StartNewGame();
    }
    void ClickOnButton(int i, int j)
    {
        BeaverUI.MakeMove(i, j);
        this.StateHasChanged();
    }

    void UpdateScreen()
    {
        InvokeAsync(this.StateHasChanged);
    }

    bool CompareBools(bool b1, bool b2)
    {

        return b1 != b2;
    }

    bool AreBoolsEqual(bool b1, bool b2)
    {
        return !CompareBools(b1, b2);
    }

    bool FalseEqualTo()
    {
        return false;
    }
}
